:_mod-docs-content-type: PROCEDURE

[id="proc-install-rhdh-orchestrator-airgapped-env-using-helm-chart.adoc_{context}"]
= Installing {product} with Orchestrator in an air-gapped environment using Helm chart


.Prerequisites

* You have mirrored the {product} {product-version} Helm chart images to the local registry. See {installing-in-air-gap-book-link}#assembly-install-rhdh-airgapped-environment-ocp-helm_title-install-rhdh-air-grapped[Installing {product} on {ocp-short} in an air-gapped environment with the Helm chart] for instructions.

* You have mirrored `orchestrator-infra` chart images to the local registry.

include::snip-installing-the-orchestrator-common-prerequisites.adoc[]

.Procedure

include::snip-installing-the-orchestrator-common-steps.adoc[]

. Apply the `orchestrator-infra` Helm chart using the instructions provided in the {installing-in-air-gap-book-link}#assembly-install-rhdh-airgapped-environment-ocp-helm_title-install-rhdh-air-grapped[Installing {product} on {ocp-short} in an air-gapped environment with the Helm chart] guide and approve the install plans.

. Apply the {product-very-short} {product-version} Helm chart. Include the version `1.7.1` and enable the Orchestrator plugin as shown in the following example:
+
[source,yaml]
----
orchestrator.enabled=true
----

. Modify the deployment created by the Helm chart instead of the {product-custom-resource-type} Custom Resource.
+
[NOTE]
====
Helm installs as a default the full URL of the `tgz` files that point towards the {company-name} NPM registry. Therefore, the redirect towards the custom registry fails.
====
+
In the default created `<release name>-dynamic-plugins` ConfigMap, replace the full URLs for the Orchestrator plugins with simplified package references as shown in the following example:
+
[source,yaml]
----
- package: "@redhat/backstage-plugin-orchestrator@1.7.1"
- package: "@redhat/backstage-plugin-orchestrator-backend-dynamic@1.7.1"
- package: "@redhat/backstage-plugin-scaffolder-backend-module-orchestrator-dynamic@1.7.1"
- package: "@redhat/backstage-plugin-orchestrator-form-widgets@1.7.1"
----

.Verification

* Restart the {product-very-short} pod and wait for the components to deploy properly.

* Once stable go to the {product-very-short} UI, and confirm that the Orchestrator UI is accessible and functioning correctly.

[NOTE]
====
The successful accessibility of the Orchestrator UI confirms that the underlying components are running and the cluster recognizes the plugin.
====